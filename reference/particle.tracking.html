<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimate a 'movement kernel' describing the movement of biomass. — particle.tracking • BiomassTracking</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate a 'movement kernel' describing the movement of biomass. — particle.tracking"><meta property="og:description" content="A movement kernel is meant to summarise the movement of biomass
across polygon-shaped areas in the ocean. It is estimated using a 4-th order
Runge-Kutta particle tracking algorithm, which records the moves of passive
numerical drifters from polygon to polygon."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BiomassTracking</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate a 'movement kernel' describing the movement of biomass.</h1>
    
    <div class="hidden name"><code>particle.tracking.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A <code>movement kernel</code> is meant to summarise the movement of biomass
across polygon-shaped areas in the ocean. It is estimated using a 4-th order
Runge-Kutta particle tracking algorithm, which records the moves of passive
numerical drifters from polygon to polygon.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">particle.tracking</span><span class="op">(</span><span class="va">arena</span>, <span class="va">num_particles</span>, no_move_window <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  end_t_counter <span class="op">=</span> <span class="cn">NULL</span>, t_step <span class="op">=</span> <span class="cn">NULL</span>, diffusion <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  no_age_classes <span class="op">=</span> <span class="st">"FD"</span>, min_nac <span class="op">=</span> <span class="fl">100</span>, max_nac <span class="op">=</span> <span class="fl">500</span>, delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  graphics <span class="op">=</span> <span class="cn">FALSE</span>, log <span class="op">=</span> <span class="cn">FALSE</span>, from_boundary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>arena</dt>
<dd><p>An object of class <code>arena</code>, see details.</p></dd>


<dt>num_particles</dt>
<dd><p>The number of particles used for the estimation.</p></dd>


<dt>no_move_window</dt>
<dd><p>Number of time steps in which no move between polygons
has to occur in order for the particle tracking to stop. Use 0 to disable.</p></dd>


<dt>end_t_counter</dt>
<dd><p>The maximal number of time steps used in the
Runge-Kutta scheme. Has to be specified if log==TRUE.</p></dd>


<dt>t_step</dt>
<dd><p>The time step used in the Runge-Kutta scheme. See details for
the default value.</p></dd>


<dt>diffusion</dt>
<dd><p>A diffusion coefficient, see details.</p></dd>


<dt>no_age_classes</dt>
<dd><p>The number of age classes used in the <code>movement
kernel</code>, takes <code>Sturges</code>, <code>FD</code>, <code>scott</code> or an integer number.
See details.</p></dd>


<dt>min_nac</dt>
<dd><p>The minimum number of age classes.</p></dd>


<dt>max_nac</dt>
<dd><p>The maximum number of age classes.</p></dd>


<dt>delta</dt>
<dd><p>The width of an age class used in the movement kernel, chosen
automatically if NULL.</p></dd>


<dt>graphics</dt>
<dd><p>If TRUE, the remaining particles at the end of the
Runge-Kutta simulation are shown.</p></dd>


<dt>log</dt>
<dd><p>If TRUE, the path of the particles is saved to a global variable
'log' and displayed if graphics==TRUE. Only use for a small number of
particles!</p></dd>


<dt>from_boundary</dt>
<dd><p>If TRUE, particles are inserted from the boundary,
otherwise they are uniformly distributed over the domain. This might be
advantageous for plotting purposes if log=TRUE.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>movement\_kernel</code>, which is a list of the
following items:</p>
<dl><dt>P</dt>
<dd><p>A list of the movement tensors for each polygon,
where <code>P[[poly]][i,j,k]</code> describes the probability of a particle
leaving polygon <code>poly</code> towards polygon <code>j</code> in the case that it
entered from polygon <code>i</code> and is in age class <code>k</code>.</p></dd>
 <dt>nk</dt>
<dd><p>A
list containing the neighbours for each polygon. This is used to translate
between the local neighbourhood numbers (used in <code>P</code>) to the global
numbers of the polygons.</p></dd>
 <dt>no_age_classes</dt>
<dd><p>The number of age classes
used in the movement kernel.</p></dd>
 <dt>delta</dt>
<dd><p>Width of the age classes used in
the movement kernel.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The two main bits of work in this function, the Runge-Kutta simulation and
the estimation of the <code>movement\_ kernel</code>, have been implemented in the
C dlls <code>particle\_tracking</code> and <code>estimate\_P</code>. Even so, the
runtime of this function can be quite high when using large numbers of
particles and/or a large domain. It is important to note that in the present
form, particles can get caught in 'voids' in the flow field, i.e. in places
where their velocity is 0. If this happens for too many particles the
estimation should be repeated with a higher values of diffusion.  A warnings
message is given at the end of the simulation, indicating the number of
particles left in the domain.</p>
<p>There is considerable space for improvement in replacing the fixed time step
Runge-Kutta scheme with a more sophisticated numerical integrator. However,
this requires some fiddling with the underlying C functions and has not been
tried yet.</p>
<p>An <code>arena</code> object describes the arena in which the function is to be
used. It is a list containing elements <code>lat</code>, <code>lon</code>, <code>U</code>,
<code>V</code> and <code>S</code> (in that order), where <code>lat</code> and <code>lon</code> are
vectors storing the latitude and longitude values of the grid points used,
<code>U</code> and <code>V</code> are matrices with the corresponding flow velocities in
west-east and south-north direction, and <code>S</code> is a matrix in which each
grid points has an integer number, either giving the polygon it belongs to
(if &gt; 0) or stating that this grid point lies on land (if == 0).</p>
<p>The default values for the time step in the Runge-Kutta scheme is choosen in
such a way that a particle will on average move for 1/10 of the distance
between two grid points in each time step. Although a variable time step
would be preferable, this yields an accurate estimation in most cases.</p>
<p>Diffusion is included by adding the product of a normal random number and
the mean velocity in the either direction to the calculated velocity in that
direction. The diffusion coefficient gives the standard variation of the
normal random number. Diffusion is needed to get particles out of 'voids',
i.e. places in the flow field where the adjacent velocities cancel out and
the particles get stuck. It is also physically justifiable as the flow field
itself characterises advective motion only.</p>
<p>The main loss of precision in the replication and prediction of movement
stems from the management of time, which is realised as a system of 'age
classes' in the movement kernel. A particle entering a polygon is in age
class 1 and then moves up through the age classes. Each age class has
different probabilities of movement attached to it, so that the movement of
a biomass depends on the time since it entered its current polygon. Since
the choice of the number of age classes and their width <code>delta</code> can
have a profound effect, the user can choose whether to trust one of the
built-in methods (<code>Sturges</code>, <code>FD</code>, <code>scott</code>) which are usually
used to choose the number of classes in a histogram, or specificy his or her
own number of age classes. The default uses the Freedman-Diaconis rule
(<code>FD</code>), which usually produces the highest number of age-classes and
therefore the best precision. Unless the performance of the function
<code>biomass\_tracking</code> is totally unsatisfactory due to the high number of
age-classes, less age-classes should not be used, as the loss of precision
can be quite severe.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>TODO: my report</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="biomass.tracking.html">biomass.tracking</a></code>,
<code><a href="particle.tracking.compare.html">particle.tracking.compare</a></code>, <code><a href="biomass.compare.html">biomass.compare</a></code>,
<code><a href="prepare.arena.html">prepare.arena</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Thorsten Lenser</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Udata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Vdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Sdata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">arena</span> <span class="op">=</span> <span class="fu"><a href="prepare.arena.html">prepare.arena</a></span><span class="op">(</span><span class="va">Udata</span>,<span class="va">Vdata</span>,<span class="va">Sdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">arena</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use more particles if realistic results are needed</span></span></span>
<span class="r-in"><span><span class="va">mk</span> <span class="op">=</span> <span class="fu">particle.tracking</span><span class="op">(</span><span class="va">arena</span>,<span class="fl">400</span>,<span class="fl">5000</span>,diffusion<span class="op">=</span><span class="fl">0.6</span>,graphics<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="particle.tracking-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now estimate the biomass movement</span></span></span>
<span class="r-in"><span><span class="va">N1</span> <span class="op">=</span> <span class="fu"><a href="biomass.tracking.html">biomass.tracking</a></span><span class="op">(</span><span class="va">mk</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4900</span>,by<span class="op">=</span><span class="fl">100</span><span class="op">)</span>,infl_poly<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get a particle tracking result to compare the above to</span></span></span>
<span class="r-in"><span><span class="va">N2</span> <span class="op">=</span> <span class="fu"><a href="particle.tracking.compare.html">particle.tracking.compare</a></span><span class="op">(</span><span class="va">arena</span>,<span class="fl">400</span>,<span class="fl">100</span>,<span class="fl">50</span>,diffusion<span class="op">=</span><span class="fl">0.6</span>,infl_poly<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Particles left in domain after the time for particle tracking elapsed: </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>33</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare the results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="biomass.compare.html">biomass.compare</a></span><span class="op">(</span><span class="va">N1</span>,<span class="va">N2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="particle.tracking-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 46.079122  1.836061</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Thorsten Lenser, Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

